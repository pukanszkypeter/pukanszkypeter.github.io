---
// Navbar.astro
import { getRelativeLocaleUrl } from "astro:i18n";
import { getLangFromUrl } from "../utils/i18n";

const lang = getLangFromUrl(Astro.url);
const t = await import(`../i18n/${lang}.json`).then((m) => m.default);
---

<nav
  class="fixed top-0 w-full bg-white dark:bg-gray-900 shadow-lg z-50 transition-colors duration-300"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <!-- Logo/Home -->
      <a
        href="#home"
        class="text-xl font-bold text-primary hover:text-secondary transition-colors"
      >
        PP
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex space-x-8">
        <a
          href="#introduction"
          class="text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
          >{t.nav.introduction}</a
        >
        <a
          href="#hobbies"
          class="text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
          >{t.nav.hobbies}</a
        >
        <a
          href="#languages"
          class="text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
          >{t.nav.languages}</a
        >
        <a
          href="#certificates"
          class="text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
          >{t.nav.certificates}</a
        >
        <a
          href="#skills"
          class="text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
          >{t.nav.skills}</a
        >
        <a
          href="#education"
          class="text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
          >{t.nav.education}</a
        >
        <a
          href="#experience"
          class="text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
          >{t.nav.experience}</a
        >
      </div>

      <!-- Controls -->
      <div class="flex items-center space-x-4">
        <!-- Language Switcher -->
        <div class="relative">
          <select
            id="lang-select"
            class="bg-transparent text-gray-700 dark:text-gray-300 border-none outline-none cursor-pointer"
          >
            <option value="en" selected={lang === "en"}>EN</option>
            <option value="hu" selected={lang === "hu"}>HU</option>
            <option value="de" selected={lang === "de"}>DE</option>
          </select>
        </div>

        <!-- Theme Toggle -->
        <button
          id="theme-toggle"
          class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
            ></path>
          </svg>
        </button>

        <!-- Mobile menu button -->
        <button
          id="mobile-menu-button"
          class="md:hidden p-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="hidden md:hidden pb-4">
      <a
        href="#introduction"
        class="block py-2 text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
        >{t.nav.introduction}</a
      >
      <a
        href="#hobbies"
        class="block py-2 text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
        >{t.nav.hobbies}</a
      >
      <a
        href="#languages"
        class="block py-2 text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
        >{t.nav.languages}</a
      >
      <a
        href="#certificates"
        class="block py-2 text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
        >{t.nav.certificates}</a
      >
      <a
        href="#skills"
        class="block py-2 text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
        >{t.nav.skills}</a
      >
      <a
        href="#education"
        class="block py-2 text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
        >{t.nav.education}</a
      >
      <a
        href="#experience"
        class="block py-2 text-gray-700 dark:text-gray-300 hover:text-secondary transition-colors"
        >{t.nav.experience}</a
      >
    </div>
  </div>
</nav>

<script>
  // Theme toggle
  const themeToggle = document.getElementById("theme-toggle");
  const html = document.documentElement;

  // Check for saved theme preference or default to light mode
  const savedTheme = localStorage.getItem("theme") || "light";
  if (savedTheme === "dark") {
    html.classList.add("dark");
  }

  themeToggle?.addEventListener("click", () => {
    html.classList.toggle("dark");
    const isDark = html.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  });

  // Language switcher
  const langSelect = document.getElementById("lang-select");
  langSelect?.addEventListener("change", (e) => {
    const target = e.target as HTMLSelectElement;
    const selectedLang = target.value;
    const currentPath = window.location.pathname;
    const newPath = currentPath.replace(/^\/[a-z]{2}/, `/${selectedLang}`);
    window.location.href = newPath;
  });

  // Mobile menu toggle
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  mobileMenuButton?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
  });
</script>
